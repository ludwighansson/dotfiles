#!/usr/bin/env bash

function cycle_v2() {
  test "${1}" = "reverse" || is_reversed="| reverse"
  
  yabai -m query --spaces --space \
  | jq -re ".index" \
  | xargs -I{} yabai -m query --windows --space {} \
  | jq -sre 'add | map(select(."is-minimized" == false)) | map(select(."app" != "Emoji & Symbols")) | sort_by(.display, .frame.y, .frame.x, .id) '"${is_reversed}"' | nth(index(map(select(."has-focus" == true))) - 1).id' \
  | xargs -I{} yabai -m window --focus {}
}


if [[ "${1}" == "forward" ]]; then
	cycle_v2
fi

if [[ "${1}" == "reverse" ]]; then
	cycle_v2 reverse
fi
